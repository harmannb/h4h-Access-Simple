
{% extends 'layouts/main.html' %}
{% block title %}Find a Pharmacy{% endblock %}
{% block content %}
<section>
   <div class="col-md-12">
      <a href="/"><img id="logo" height='100' src='../../static/img/withinreachlogo.png' class="img" alt="within reach logo" /></a>
  </div>
  <div id="map" style="height: 500px;"></div>
</section>

<script>
      // Initialize the map.
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8,
          center: {lat: 40.72, lng: -73.96}
        });
        var geocoder = new google.maps.Geocoder;
        var infowindow = new google.maps.InfoWindow;
        geocodePlaceId(geocoder, map, infowindow);
      }

      function geocodePlaceId(geocoder, map, infowindow) {
        var placeIds = {{ placeIds|tojson }};
        console.log('in JS', placeIds);
        var placeIdOne = placeIds[0][0];
        var name = placeIds[0][1];
        geocoder.geocode({'placeId': placeIdOne}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              map.setZoom(11);
              map.setCenter(results[0].geometry.location);
              var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
              });
              var contentString = '<p>'+ name + '</p><p>' + results[0].formatted_address + '</p>';
              infowindow.setContent(contentString);
              marker.addListener('click', function() {
                infowindow.open(map, marker);
              });
            } else {
              window.alert('No results found');
            }
          } else {
            window.alert('Geocoder failed due to: ' + status);
          }
        });
        console.log(placeIds);
        // placeIds.forEach(function(placeId) {
        //   setTimeout(geocoder.geocode({'placeId': placeId}, function(results, status) {
        //   if (status === 'OK') {
        //     if (results[0]) {
        //       var marker = new google.maps.Marker({
        //         map: map,
        //         position: results[0].geometry.location
        //       });
        //       var contentString = '<p>' + results[0].name + '</p><p>' + results[0].formatted_address + '</p>';
        //       infowindow.setContent(contentString);
        //       marker.addListener('click', function() {
        //         infowindow.open(map, marker);
        //       });
        //     } else {
        //       window.alert('No results found');
        //     }
        //   } else {
        //     window.alert('Geocoder failed due to: ' + status);
        //   }
        // }), 2000);

      // });

      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=API_KEY&libraries=places&callback=initMap">
    </script>

{% endblock %}